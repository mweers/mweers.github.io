<!DOCTYPE html>
<html>
<head>
    <title>Daily Step Count Graph</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        .bar { fill: #a2d2ac; }
        .bar:hover { fill: #d3aae3; }
        .axis-label { font-size: 12px; }
        .tooltip {
            position: absolute;
            text-align: center;
            width: 60px;
            height: 28px;
            padding: 2px;
            font: 12px sans-serif;
            background: #fff9f9;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
        }
    </style>
</head>
<body>
<div class="tooltip" id="tooltip"></div> <!-- Tooltip div added here -->

<script>

    // Define a time parser
    const parseDate = d3.timeParse("%m/%d/%Y");
    const tooltip = d3.select("#tooltip");

    // Load the dataset
    d3.csv('https://raw.githubusercontent.com/mweers/mweers.github.io/master/steps.csv').then(function(data) {
        // Process data
        data.forEach(d => {
            d.Date = parseDate(d.Date);
            d.Steps = +d.Steps; // Convert 'steps' to number
        });
        console.log("Processed data: ", data);

        // Set up SVG canvas
        const svg = d3.select('body').append('svg')
            .attr('width', '100%')
            .attr('height', 500)
            .style('border', '1px solid black');

        // Create scales and axes
        const x = d3.scaleBand()
                .range([0, window.innerWidth - 100])
                .padding(0.1)
                .domain(data.map(d => d.Date)),
            y = d3.scaleLinear()
                .range([450, 0])
                .domain([0, d3.max(data, d => d.Steps)]);

        // Append X axis
        svg.append('g')
            .attr('transform', 'translate(50,450)')
            .call(d3.axisBottom(x))
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", ".15em")
            .attr("transform", "rotate(-65)");

        // Append Y axis
        svg.append('g')
            .attr('transform', 'translate(50,0)')
            .call(d3.axisLeft(y));

        svg.selectAll('.bar')
            .data(data)
            .enter().append('rect')
            .attr('class', 'bar')
            .attr('x', d => x(d.Date) + 50)
            .attr('y', d => y(d.Steps))
            .attr('width', x.bandwidth())
            .attr('height', d => 450 - y(d.Steps))
            .on('mouseover', function(event, d) {
                tooltip.transition()
                    .duration(200)
                    .style('opacity', .9);
                tooltip.html('Steps: ' + d.Steps)
                    .style('left', (event.pageX) + 'px')
                    .style('top', (event.pageY - 28) + 'px');
            })
            .on('mouseout', function(d) {
                tooltip.transition()
                    .duration(500)
                    .style('opacity', 0);
            });
        // Responsive resizing
        function resize() {
            var newWidth = window.innerWidth - 100;
            x.range([0, newWidth]);
            svg.selectAll('.bar')
                .attr('x', d => x(d.Date) + 50)
                .attr('width', x.bandwidth());
            svg.select('.x.axis').call(d3.axisBottom(x));
        }

        d3.select(window).on('resize', resize);
    });
</script>
</body>
</html>
